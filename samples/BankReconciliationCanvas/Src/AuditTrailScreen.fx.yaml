AuditTrailScreen As screen:
    Fill: =RGBA(248, 250, 252, 1)
    OnVisible: =Set(CurrentTab, "Audit")
    
    # Header Container
    containerHeader As container:
        Fill: =RGBA(255, 255, 255, 1)
        Height: =80
        Width: =Parent.Width
        X: =0
        Y: =0
        
        lblHeaderTitle As label:
            Text: ="Audit Trail"
            FontWeight: =FontWeight.Bold
            Size: =18
            Color: =ColorBank
            X: =20
            Y: =20
            Width: =300
            Height: =40
        
        lblUserName As label:
            Text: =CurrentUserProfile.name
            Size: =12
            Color: =RGBA(100, 116, 139, 1)
            Align: =Align.Right
            X: =Parent.Width - 180
            Y: =25
            Width: =150
            Height: =30
        
        iconUser As icon:
            Icon: =Icon.Person
            Color: =ColorBank
            Height: =30
            Width: =30
            X: =Parent.Width - 20
            Y: =25
    
    # Navigation Tabs
    containerNavigation As container:
        Fill: =RGBA(255, 255, 255, 1)
        Height: =60
        Width: =Parent.Width
        X: =0
        Y: =containerHeader.Height
        
        btnNavDashboard As button:
            Text: ="Dashboard"
            Fill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(100, 116, 139, 1)
            BorderThickness: =0
            X: =10
            Y: =10
            Width: =150
            Height: =40
            OnSelect: =Navigate(DashboardScreen, ScreenTransition.None)
        
        btnNavMatching As button:
            Text: ="Matching"
            Fill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(100, 116, 139, 1)
            BorderThickness: =0
            X: =btnNavDashboard.X + btnNavDashboard.Width + 5
            Y: =10
            Width: =150
            Height: =40
            OnSelect: =Navigate(MatchingScreen, ScreenTransition.None)
        
        btnNavReconciliation As button:
            Text: ="Reconciliation"
            Fill: =RGBA(255, 255, 255, 1)
            Color: =RGBA(100, 116, 139, 1)
            BorderThickness: =0
            X: =btnNavMatching.X + btnNavMatching.Width + 5
            Y: =10
            Width: =150
            Height: =40
            OnSelect: =Navigate(ReconciliationScreen, ScreenTransition.None)
        
        btnNavAudit As button:
            Text: ="Audit Trail"
            Fill: =RGBA(0, 120, 212, 0.1)
            Color: =ColorBank
            BorderColor: =ColorBank
            BorderThickness: =2
            X: =btnNavReconciliation.X + btnNavReconciliation.Width + 5
            Y: =10
            Width: =150
            Height: =40
    
    # Filter Bar
    containerAuditFilters As container:
        Fill: =RGBA(255, 255, 255, 1)
        Height: =80
        Width: =Parent.Width - 40
        X: =20
        Y: =containerHeader.Height + containerNavigation.Height + 10
        
        lblAuditFiltersTitle As label:
            Text: ="Filter Audit Log"
            FontWeight: =FontWeight.Semibold
            Size: =14
            Color: =RGBA(30, 41, 59, 1)
            X: =15
            Y: =15
            Width: =150
            Height: =25
        
        ddCategoryFilter As dropdown:
            Items: =["All", "Transaction", "System", "Data", "User"]
            Default: ="All"
            HintText: ="Category"
            X: =15
            Y: =45
            Width: =180
            Height: =35
        
        ddSeverityFilter As dropdown:
            Items: =["All", "Info", "Warning", "Error"]
            Default: ="All"
            HintText: ="Severity"
            X: =205
            Y: =45
            Width: =150
            Height: =35
        
        txtAuditSearch As text input:
            HintText: ="Search audit entries..."
            X: =365
            Y: =45
            Width: =220
            Height: =35
        
        lblAuditCount As label:
            Text: =CountRows(galAuditLog.AllItems) & " entries"
            Size: =12
            Color: =RGBA(100, 116, 139, 1)
            Align: =Align.Right
            X: =Parent.Width - 130
            Y: =15
            Width: =120
            Height: =25
    
    # Audit Log Gallery
    galAuditLog As gallery:
        Items: |
            =Filter(
                AuditLog,
                (ddCategoryFilter.Selected.Value = "All" Or category = ddCategoryFilter.Selected.Value) And
                (ddSeverityFilter.Selected.Value = "All" Or severity = ddSeverityFilter.Selected.Value) And
                (IsBlank(txtAuditSearch.Text) Or 
                    txtAuditSearch.Text in action Or 
                    txtAuditSearch.Text in details Or
                    txtAuditSearch.Text in actor
                )
            )
        Layout: =Layout.Vertical
        TemplatePadding: =0
        TemplateSize: =120
        Height: =Parent.Height - containerAuditFilters.Y - containerAuditFilters.Height - 70
        Width: =Parent.Width - 40
        X: =20
        Y: =containerAuditFilters.Y + containerAuditFilters.Height + 10
        
        containerAuditItem As container:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =110
            Width: =Parent.TemplateWidth - 10
            
            # Severity Icon
            iconSeverity As icon:
                Icon: =Switch(ThisItem.severity, "Error", Icon.Cancel, "Warning", Icon.Warning, Icon.Info)
                Color: =Switch(ThisItem.severity, "Error", ColorDanger, "Warning", ColorWarning, ColorBank)
                Height: =30
                Width: =30
                X: =10
                Y: =10
            
            # Category Badge
            lblCategory As label:
                Text: =ThisItem.category
                Size: =10
                Color: =RGBA(255, 255, 255, 1)
                Fill: =Switch(ThisItem.category, "Transaction", ColorBank, "System", ColorAI, "Data", ColorSage, RGBA(100, 116, 139, 1))
                Align: =Align.Center
                PaddingLeft: =6
                PaddingRight: =6
                PaddingTop: =3
                PaddingBottom: =3
                X: =50
                Y: =15
                Width: =90
                Height: =22
            
            # Timestamp
            lblTimestamp As label:
                Text: =Text(ThisItem.timestamp, "mmm dd, yyyy hh:mm AM/PM")
                Size: =10
                Color: =RGBA(100, 116, 139, 1)
                Align: =Align.Right
                X: =Parent.Width - 180
                Y: =15
                Width: =170
                Height: =22
            
            # Action Title
            lblAction As label:
                Text: =ThisItem.action
                FontWeight: =FontWeight.Semibold
                Size: =13
                Color: =RGBA(30, 41, 59, 1)
                X: =50
                Y: =45
                Width: =Parent.Width - 70
                Height: =22
            
            # Actor
            lblActor As label:
                Text: |
                    ="By: " & ThisItem.actor
                Size: =11
                Color: =RGBA(100, 116, 139, 1)
                X: =50
                Y: =70
                Width: =200
                Height: =18
            
            # Details
            lblDetails As label:
                Text: =ThisItem.details
                Size: =11
                Color: =RGBA(71, 85, 105, 1)
                X: =50
                Y: =90
                Width: =Parent.Width - 70
                Height: =18
    
    # Empty State
    containerAuditEmpty As container:
        Fill: =RGBA(255, 255, 255, 1)
        Height: =200
        Width: =Parent.Width - 40
        X: =20
        Y: =containerAuditFilters.Y + containerAuditFilters.Height + 10
        Visible: =CountRows(galAuditLog.AllItems) = 0
        
        iconEmptyAudit As icon:
            Icon: =Icon.DocumentSearch
            Color: =RGBA(203, 213, 225, 1)
            Height: =60
            Width: =60
            X: =(Parent.Width - 60) / 2
            Y: =40
        
        lblEmptyAuditMessage As label:
            Text: ="No audit entries found"
            Size: =14
            Color: =RGBA(100, 116, 139, 1)
            Align: =Align.Center
            X: =0
            Y: =110
            Width: =Parent.Width
            Height: =30
        
        lblEmptyAuditHint As label:
            Text: ="Try adjusting your filters"
            Size: =12
            Color: =RGBA(148, 163, 184, 1)
            Align: =Align.Center
            X: =0
            Y: =145
            Width: =Parent.Width
            Height: =25

